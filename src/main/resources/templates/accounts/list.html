<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<!--/*/ <th:block th:include="fragments/head :: head"/> /*/-->
		<script th:inline="javascript">
		/*<![CDATA[*/
		$(document).ready(function() {
			var editor; // use a global for the submit and return data rendering in the examples
			//var ajaxBase = {
			//		dataSrc: "",
			//		dataType: "json",
			//		contentType: "application/json; charset=utf-8",
			//		processData: "false",
			//		url: "/api/accounts/user/" + /*[[${currentUser.id}]]*/ 
			//};
			
			var restlnk = "/api/accounts/user/" + /*[[${currentUser.id}]]*/
			$.fn.dataTable.ext.buttons.uploadfile = {
					text: 'Import',
					action: function ( e, dt, node, config ) {
						var file_data = $("#filedialog").prop("files")[0];
						var form_data = new FormData();
						form_data.append("file", file_data);
						 $.ajax({
							url: restlnk + "/import",
							dataType: "json",
							cache: false,
							contentType: false,
							processData: false,
							data:form_data,
							type: 'POST',
							error: function (xhr, error, thrown) {
								console.log("error" + error.toString());
								console.log("xhr:" + xhr.toString());
								console.log("thrown:" + thrown.toString());
					 		},
							success: function(returnedData) {
								console.log(returnedData);
								location.reload();
							}
						 });
					}
				};
			
			editor = new $.fn.dataTable.Editor( {
					ajax: {
						create: {
							type: 'POST',
							dataType: "json",
							contentType: "application/json; charset=utf-8",
							url: restlnk ,
							data: function ( d ) {
								return JSON.stringify( d['data'] );
							}
						},
						edit: {
							type: 'PUT',
							dataType: "json",
							contentType: "application/json; charset=utf-8",
							url: restlnk,
							data: function ( d ) {
								return JSON.stringify( d['data'] );
							}
						},
						remove: {
							type: 'POST',
							contentType: "application/json; charset=utf-8",
							dataType: "json",
							url: restlnk + "/delete",
							data: function ( d ) {
								return JSON.stringify( d['data'] );
							}
						}
					},
					table: "#leagueinformer-datatable-accounts",
					fields: [{
						label: "ID",
						name: "id",
						type: "hidden",
						def: "0"
					},{
						label: "Active:",
						name: "active",
						type: "checkbox",
						options: [
							{ label: "", value: true }
						],
						separator: '',
						unselectedValue: false
					}, {
						label: "Account",
						name: "account"
					},{
						label: "Password",
						name: "password"
					},{
						label: "Summoner",
						name: "summoner",
						type: "readonly"
					},{
						label: "Region",
						name: "region",
						type: "select",
						options: [
							{ label: "NA", value: "NA" },
							{ label: "EUW", value: "EUW" },
							{ label: "EUNE", value: "EUNE"},
							{ label: "BR", value: "EUW" },
							{ label: "LAN", value: "EUW" },
							{ label: "LAS", value: "EUW" },
							{ label: "OCE", value: "EUW" },
							{ label: "RU", value: "EUW" },
							{ label: "TR", value: "EUW" }
						],
						def: "NA"
					},{
						label: "Level",
						name: "level",
						type: "readonly",
						def: "0"
					},{
						label: "M. Lvl,
						name: "maxLevel"
					},{
						label: "XP",
						name: "xp",
						type: "readonly"
					},{
						label: "BE",
						name: "be",
						type: "readonly"
					},{
						label: "M. BE",
						name: "maxBe"
					},{
						label: "Priority",
						name: "priority",
						type: "select",
						options: [
							{ label: "1", value: "1" },
							{ label: "2", value: "2" },
							{ label: "3", value: "3"},
							{ label: "4", value: "4" },
							{ label: "5", value: "5" },
							{ label: "6", value: "6" },
							{ label: "7", value: "7" },
							{ label: "8", value: "8" },
							{ label: "9", value: "9" }
						]
					},{
						label: "Playtime",
						name: "playTime"
					},{
						label: "Sleeptime",
						name: "sleepTime"
					},{
						label: "Status",
						name: "accountStatus",
						type: "readonly",
						def: "NEW"
					},{
						label: "Assigned To",
						name: "assignedTo",
						type: "readonly",
						def: "None"
					},{
						label: "Info",
						name: "info",
						def: "No extra info"
					}],
					idSrc:'id'
			} );
		
			var table = $('#leagueinformer-datatable-accounts').DataTable( {
				responsive: true,
				dom: "Bfrtip",
				ajax:{
					"url": "/api/accounts/user/" + /*[[${currentUser.id}]]*/ ,
					"dataSrc": "data",
					"dataType": "json",
					"cache": false,
					"contentType": "application/json; charset=utf-8"
				},
				columns: [
				{ data: "id" },
				{ data: "active"},
				{ data: "account" },
				{ data: "password" },
				{ data: "summoner" },
				{ data: "region" },
				{ data: "level" },
				{ data: "maxLevel" },
				{ data: "xp" },
				{ data: "be" },
				{ data: "maxBe" },
				{ data: "priority" },
				{ data: "playTime" },
				{ data: "sleepTime" },
				{ data: "accountStatus" },
				{ data: "assignedTo" },
				{ data: "info" }

				],
				columnDefs: [
				{ targets: [0,4,7,8,9,10,11,12,13,15,16], visible: false}
				],
				select: true,
				buttons: [
				{ extend: "create", editor: editor },
				{ extend: "edit",   editor: editor },
				{ extend: "remove", editor: editor },
				{
					extend: 'collection',
					text: 'Export',
					buttons: [
						'copy',
						'excel',
						'csv',
						'pdf',
						'print'
					]
				},
				{ 	extend: 'collection',
					text: 'Import',
					buttons: [
						{ text: 'Select File',   action: function () {$("#filedialog").click();} },
						{ extend: "uploadfile", editor: editor }
					]
				}
				]
			} );
			
			$('a.toggle-vis').on( 'click', function (e) {
				e.preventDefault();
				var column = table.column( $(this).attr('data-column') );
				column.visible( ! column.visible() );
			} );
			
		} );/*]]>*/
		</script>
	</head>
	<body>
		<div class="container">
			<div class="row">
				<!--/*/ <th:block th:include="fragments/mainNav :: mainNav"/> /*/-->
			</div>
			<div class="row">
				<div class="col-xs-12">
					<table id="leagueinformer-datatable-accounts" class="table table-striped table-bordered" width="100%" >
						<thead>
							<tr>
								<th>ID</th>
								<th>Active</th>
								<th>Account</th>
								<th>Password</th>
								<th>Summoner</th>
								<th>Region</th>
								<th>Level</th>
								<th>M. Lvl</th>
								<th>XP</th>
								<th>BE</th>
								<th>M. BE</th>
								<th>Priority</th>
								<th>Playtime</th>
								<th>Sleeptime</th>
								<th>Account Status</th>
								<th>Assigned To</th>
								<th>Info</th>
							</tr>
						</thead>
					</table>
					<input id="filedialog" type="file" name ="filedialog" accept="text/plain" style="display:none"/>
				</div>
			</div>
			<div class = "row">
				<div class="col-xs-12">
					<a class="toggle-vis" data-column="1">Active</a> - <a class="toggle-vis" data-column="2">Account</a> - <a class="toggle-vis" data-column="3">Password</a> - <a class="toggle-vis" data-column="4">Summoner</a> - <a class="toggle-vis" data-column="5">Region</a> - <a class="toggle-vis" data-column="6">Level</a> - <a class="toggle-vis" data-column="7">Max Level</a> - <a class="toggle-vis" data-column="8">XP</a> - <a class="toggle-vis" data-column="9">BE</a> - <a class="toggle-vis" data-column="10">Max BE</a> - <a class="toggle-vis" data-column="11">Priority</a> - <a class="toggle-vis" data-column="12">Playtime</a> - <a class="toggle-vis" data-column="13">Sleeptime</a> - <a class="toggle-vis" data-column="14">Account Status</a> - <a class="toggle-vis" data-column="11">Assigned To</a> - <a class="toggle-vis" data-column="11">Info</a>
				</div>
			</div>
		</div>
	</body>
</html>