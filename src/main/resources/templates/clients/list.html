<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<!--/*/ <th:block th:include="fragments/head :: head"/> /*/-->
		<script th:inline="javascript">
		/*<![CDATA[*/
		function format ( d ) {
			var resultHtml = "";
			var queuers = d.queuers;
			queuers.forEach(function(q){
				var qLine = "<p>";
				qLine =  qLine + "<b>" + q.queuer + ": </b> " +q.playedGames+"/" + q.winGames + "/" + q. defeatGames + "(P/W/L)";
				if (q.softEnd == "false"){
					qLine = qLine + " - Softend in " + q.afterGame + " games)";
				}else{
					qLine = qLine + " - Softend disabled";
				}
				resultHtml = resultHtml + qLine;
				var lolAccs = q.queuerLolAccounts;
				var lTable = "<table class='table table-striped table-bordered' style='width:100%'><thead><tr><th>Account</th><th>Level</th><th>XP</th><th>BE</th><th>Champion</th><th>LPQ</th></tr></thead><tbody>"
				lolAccs.forEach(function(l){
					var lRow = "<tr><td>" + l.account +"</td><td>" + l.level + " / " + l.maxLevel + "</td><td>" + l.xp + " / " + l.xpCap + "</td><td>" + l.be + "</td><td>" + l.champ + "</td><td>" + l.lpq + "</td></tr>";
					lTable = lTable + lRow;
				});
				var lTable = lTable + "</tbody></table>";
				resultHtml = resultHtml + lTable;
			});
			return resultHtml;
		}
		
		$(document).ready(function() {
			var editor; // use a global for the submit and return data rendering in the examples
			//var ajaxBase = {
			//		dataSrc: "",
			//		dataType: "json",
			//		contentType: "application/json; charset=utf-8",
			//		processData: "false",
			//		url: "/api/accounts/user/" + /*[[${currentUser.id}]]*/ 
			//};
			
			var restlnk = "/api/clients/user/" + /*[[${currentUser.id}]]*/
			
			editor = new $.fn.dataTable.Editor( {
					ajax: {
						remove: {
							type: 'POST',
							contentType: "application/json; charset=utf-8",
							dataType: "json",
							url: restlnk + "/delete",
							data: function ( d ) {
								return JSON.stringify( d['data'] );
							}
						}
					},
					table: "#infernalbotmanager-datatable-clients",
					fields: [{
						label: "ID",
						name: "id",
						type: "hidden",
						def: "0"
					},{
						label: "Tag",
						name: "tag"
					},{
						label: "Date",
						name: "date",
						type: 'datetime',
						def: function () { return new Date(); },
						format: 'DD-MM-YYYY HH:mm'
					},{
						label: "Status",
						name: "status"
					}],
					idSrc:'id'
			} );
		
			var table = $('#infernalbotmanager-datatable-clients').DataTable( {
				responsive: true,
				dom: "Brtip",
				pageLength: 50,
				ajax:{
					"url": "/api/clients/user/" + /*[[${currentUser.id}]]*/ ,
					"dataSrc": "data",
					"dataType": "json",
					"cache": false,
					"contentType": "application/json; charset=utf-8"
				},
				columns: [
				{ data: "id" },
				{
					className:      'details-control',
					orderable:      false,
					data:           null,
					defaultContent: ''
				},
				{ data: "tag"},
				{ data: "date"},
				{ data: "status"}
				],
				columnDefs: [
				{ targets: [0], visible: false}
				],
				select: true,
				buttons: [
				{ extend: "remove", editor: editor },
				]
			} );

			// Array to track the ids of the details displayed rows
			var detailRows = [];
		
			$('#infernalbotmanager-datatable-clients tbody').on( 'click', 'tr td.details-control', function () {
				var tr = $(this).closest('tr');
				var row = table.row( tr );
				var idx = $.inArray( tr.attr('id'), detailRows );
		
				if ( row.child.isShown() ) {
					tr.removeClass( 'details' );
					row.child.hide();
		
					// Remove from the 'open' array
					detailRows.splice( idx, 1 );
				} else {
					tr.addClass( 'details' );
					row.child( format( row.data() ) ).show();
		
					// Add to the 'open' array
					if ( idx === -1 ) {
						detailRows.push( tr.attr('id') );
					}
				}
			} );
		 
			// On each draw, loop over the `detailRows` array and show any child rows
			table.on( 'draw', function () {
				$.each( detailRows, function ( i, id ) {
					$('#'+id+' td.details-control').trigger( 'click' );
				} );
			} );
		} );/*]]>*/
		</script>
	</head>
	<body>
		<!--/*/ <th:block th:include="fragments/mainNav :: mainNav"/> /*/-->
		<br/>
		<table id="infernalbotmanager-datatable-clients" class="table table-striped table-bordered display" style="width:100%" >
			<thead>
				<tr>
					<th>ID</th>
					<th></th>
					<th>Tag</th>
					<th>Date</th>
					<th>Status</th>
				</tr>
			</thead>
		</table>
	</body>
</html>